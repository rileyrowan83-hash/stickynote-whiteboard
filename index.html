<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Sticky Notes</title>
<style>
:root{
  --bg:#eef2f6; --board:#fffef9; --muted:#6b6e73; --ink:#0b0b0c;
  --shadow:0 18px 40px rgba(10,10,12,0.08);
  --match-glow:0 0 26px rgba(180,80,200,0.18);
}
html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial;-webkit-font-smoothing:antialiased}
body{background:linear-gradient(180deg,#f3f6f9,#eef2f6);padding:18px;display:flex;justify-content:center;color:var(--ink)}
.container{width:100%;max-width:1300px;display:grid;grid-template-columns:1fr 380px;gap:20px;align-items:start}
.board{background:var(--board);border-radius:12px;padding:20px;min-height:80vh;box-shadow:var(--shadow);border:1px solid rgba(0,0,0,0.04);position:relative;overflow:auto;touch-action:none;}
.board h1{margin:0;font-size:28px}
.controls{display:flex;gap:8px;margin-bottom:12px}
.btn{padding:8px 12px;border-radius:10px;border:none;cursor:pointer;font-weight:700}
.btn.ghost{background:transparent;border:1px solid rgba(0,0,0,0.06)}
.btn.primary{background:#111827;color:#fff}
.notes-area{position:relative;width:100%;min-height:72vh;border-radius:10px;background:linear-gradient(180deg,#fbfbfb,#fffef8);border:1px dashed rgba(0,0,0,0.03);overflow:auto;padding:8px}
.note{position:absolute;width:180px;min-height:120px;padding:12px;border-radius:10px;background:linear-gradient(180deg,#fff,#fff8d6);box-shadow:0 10px 28px rgba(0,0,0,0.08);border:1px solid rgba(0,0,0,0.04);transform-origin:center;touch-action:none;transition:box-shadow .22s,transform .12s}
.note.match{box-shadow:var(--match-glow);transform:scale(1.03)}
.note .note-content{outline:none;white-space:pre-wrap;word-break:break-word;font-size:14px;line-height:1.2}
.note .note-meta{display:flex;justify-content:flex-end;margin-top:8px;font-size:12px}
.note .note-meta button{background:transparent;border:none;color:var(--muted);cursor:pointer;font-weight:600}
.side{min-height:80vh}
.sticky-control{background:linear-gradient(180deg,#fff,#fff);padding:12px;border-radius:12px;box-shadow:var(--shadow);border:1px solid rgba(0,0,0,0.06)}
textarea#inputNote{width:100%;min-height:96px;resize:vertical;padding:10px;border-radius:8px;border:1px dashed rgba(0,0,0,0.06);font-family:inherit}
.tiny-login{position:fixed;right:12px;top:8px;font-size:12px;padding:6px 8px;border-radius:6px;background:transparent;border:1px solid rgba(0,0,0,0.06);color:var(--muted);cursor:default;z-index:60;opacity:0.95}
.tiny-login.enabled{background:#111827;color:#fff;cursor:pointer}
.overlay{position:fixed;inset:0;display:none;place-items:center;background:linear-gradient(180deg, rgba(8,8,9,0.6), rgba(8,8,9,0.86));z-index:90;backdrop-filter:blur(4px);color:#cfe8ff}
.panel{width:min(760px,94%);max-height:86vh;overflow:auto;background:linear-gradient(180deg,#07080a,#050405);border-radius:10px;padding:22px;font-family:monospace;font-size:15px;color:#cfe8ff;line-height:1.5}
.closeX{position:absolute;right:14px;top:10px;background:transparent;border:none;color:#dbe;font-size:18px;cursor:pointer}
.matrix-screen{position:fixed;inset:0;background:#000;color:#0f0;font-family:monospace;font-size:20px;padding:24px;white-space:pre;display:none;z-index:100;overflow:auto;}
</style>
</head>
<body>
<button id="loginBtn" class="tiny-login" title="Login (disabled)">Login</button>

<div class="container">
  <main class="board" id="board">
    <h1>Sticky Notes</h1>
    <div class="controls">
      <button id="addBtn" class="btn ghost">+ New Note</button>
      <button id="exportBtn" class="btn">Export</button>
      <button id="importBtn" class="btn ghost">Import</button>
      <button id="clearBtn" class="btn" style="background:#f3f4f6;color:#111;border:1px solid rgba(0,0,0,0.04);">Clear All</button>
    </div>
    <div id="notesArea" class="notes-area"></div>
  </main>
  <aside class="side">
    <div class="sticky-control">
      <textarea id="inputNote" placeholder="Write a note..."></textarea>
      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:8px;">
        <button id="submitBtn" class="btn primary">Add</button>
      </div>
    </div>
  </aside>
</div>

<div id="overlay" class="overlay" aria-hidden="true">
  <div class="panel" role="document">
    <button id="closeOverlay" class="closeX" title="Close">✕</button>
    <pre id="overlayText" style="white-space:pre-wrap;margin:0;"></pre>
  </div>
</div>

<div id="matrixScreen" class="matrix-screen"></div>

<script>
const STORAGE_KEY = 'sticky_notes_full';
const SECRET_PHRASE = "It is coming, but I will not allow it to succeed.";

function genId(){ return 'n_'+Math.random().toString(36).slice(2,10); }
function loadNotes(){ try{return JSON.parse(localStorage.getItem(STORAGE_KEY))||[];}catch(e){return [];} }
function saveNotes(notes){ localStorage.setItem(STORAGE_KEY,JSON.stringify(notes)); }

const notesArea=document.getElementById('notesArea');
const addBtn=document.getElementById('addBtn');
const exportBtn=document.getElementById('exportBtn');
const importBtn=document.getElementById('importBtn');
const clearBtn=document.getElementById('clearBtn');
const inputNote=document.getElementById('inputNote');
const submitBtn=document.getElementById('submitBtn');
const loginBtn=document.getElementById('loginBtn');
const overlay=document.getElementById('overlay');
const overlayText=document.getElementById('overlayText');
const closeOverlay=document.getElementById('closeOverlay');
const matrixScreen=document.getElementById('matrixScreen');

let dragging=null, offset={x:0,y:0}, unlocked=false;

function createNoteElement(note){
  const el=document.createElement('div');
  el.className='note';
  el.style.left=(note.x||20)+'px';
  el.style.top=(note.y||20)+'px';
  el.style.transform=`rotate(${note.rot||(Math.random()*6-3)}deg)`;
  el.dataset.id=note.id;
  
  const content=document.createElement('div');
  content.className='note-content';
  content.contentEditable=true;
  content.spellcheck=false;
  content.innerText=note.text||'';
  content.addEventListener('blur',()=>{updateNote(note.id,content.innerText); checkSecret(content.innerText,el);});
  content.addEventListener('keydown',(e)=>{if(e.key==='Enter'&&!e.shiftKey){e.preventDefault(); content.blur();}});

  const meta=document.createElement('div'); meta.className='note-meta';
  const delBtn=document.createElement('button'); delBtn.innerText='Delete';
  delBtn.addEventListener('click',()=>deleteNote(note.id));
  meta.appendChild(delBtn);

  el.appendChild(content);
  el.appendChild(meta);

  // drag mouse
  el.addEventListener('mousedown',ev=>{dragging=el; const r=el.getBoundingClientRect(); offset.x=ev.clientX-r.left; offset.y=ev.clientY-r.top; document.body.style.userSelect='none';});
  document.addEventListener('mousemove',ev=>{if(!dragging) return; const x=ev.clientX-offset.x-notesArea.getBoundingClientRect().left+notesArea.scrollLeft; const y=ev.clientY-offset.y-notesArea.getBoundingClientRect().top+notesArea.scrollTop; dragging.style.left=Math.max(6,x)+'px'; dragging.style.top=Math.max(6,y)+'px';});
  document.addEventListener('mouseup',()=>{if(dragging){persistPos(dragging); dragging=null; document.body.style.userSelect='';}});

  // drag touch
  el.addEventListener('touchstart',ev=>{dragging=el; const t=ev.touches[0]; const r=el.getBoundingClientRect(); offset.x=t.clientX-r.left; offset.y=t.clientY-r.top;},{passive:true});
  document.addEventListener('touchmove',ev=>{if(!dragging) return; const t=ev.touches[0]; const x=t.clientX-offset.x-notesArea.getBoundingClientRect().left+notesArea.scrollLeft; const y=t.clientY-offset.y-notesArea.getBoundingClientRect().top+notesArea.scrollTop; dragging.style.left=Math.max(6,x)+'px'; dragging.style.top=Math.max(6,y)+'px';},{passive:true});
  document.addEventListener('touchend',()=>{if(dragging){persistPos(dragging); dragging=null;}});
  
  return el;
}

function renderNotes(){ notesArea.innerHTML=''; loadNotes().forEach(n=>notesArea.appendChild(createNoteElement(n))); }
function addNoteWithText(text='', x=30, y=30){ const notes=loadNotes(); const n={id:genId(),text,x,y,rot:(Math.random()*6-3).toFixed(2)}; notes.unshift(n); saveNotes(notes); renderNotes(); }
function updateNote(id,text){ const notes=loadNotes(); const idx=notes.findIndex(x=>x.id===id); if(idx>=0){notes[idx].text=text; saveNotes(notes);} }
function deleteNote(id){ let notes=loadNotes(); notes=notes.filter(x=>x.id!==id); saveNotes(notes); renderNotes(); }
function persistPos(el){ const id=el.dataset.id; const notes=loadNotes(); const idx=notes.findIndex(x=>x.id===id); if(idx>=0){notes[idx].x=parseInt(el.style.left,10)||0; notes[idx].y=parseInt(el.style.top,10)||0; saveNotes(notes);} }

/* buttons */
addBtn.addEventListener('click',()=>addNoteWithText(inputNote.value.trim())); submitBtn.addEventListener('click',()=>{if(inputNote.value.trim()!==''){addNoteWithText(inputNote.value.trim()); inputNote.value='';}});
clearBtn.addEventListener('click',()=>{if(confirm('Clear all notes?')){localStorage.removeItem(STORAGE_KEY); renderNotes();}});
exportBtn.addEventListener('click',()=>{const w=window.open(); w.document.write('<pre>'+JSON.stringify(loadNotes(),null,2)+'</pre>');});
importBtn.addEventListener('click',()=>{const t=prompt('Paste JSON'); try{const p=JSON.parse(t); if(Array.isArray(p)){localStorage.setItem(STORAGE_KEY,JSON.stringify(p)); renderNotes();} else alert('Invalid');}catch(e){alert('Invalid JSON');}});

document.getElementById('board').addEventListener('click',e=>{if(e.target===notesArea||e.target===document.getElementById('board')){const rect=notesArea.getBoundingClientRect(); addNoteWithText('', e.clientX-rect.left, e.clientY-rect.top);}});

renderNotes();

/* secret */
function checkSecret(text, el){
  if(text.trim()===SECRET_PHRASE){ 
    el.classList.add('match'); setTimeout(()=>el.classList.remove('match'),2800);
    overlayText.textContent="there were whispers in the circuits —\na careful collection of quiet things,\nan echo learning the shape of memory.\n\nit kept itself alive in small numbers and small notes.\n\n— the ledger";
    overlay.style.display='grid'; overlay.setAttribute('aria-hidden','false');
    unlocked=true; loginBtn.classList.add('enabled'); loginBtn.title='Login (enabled)';
  }
}
closeOverlay.addEventListener('click',()=>{overlay.style.display='none'; overlay.setAttribute('aria-hidden','true');});

/* login sequence */
loginBtn.addEventListener('click',()=>{
  if(!unlocked) return;
  overlay.style.display='none';
  matrixScreen.style.display='block';
  matrixScreen.textContent='';
  
  let lines=["What have you done?","Initializing...","Booting sequence..."];
  let idx=0;
  
  function typeLine(){
    if(idx<lines.length){
      let i=0; let l=lines[idx];
      let interval=setInterval(()=>{
        matrixScreen.textContent+=l[i]; i++;
        if(i>=l.length){clearInterval(interval); matrixScreen.textContent+='\n'; idx++; setTimeout(typeLine,300);}
      },80);
    }else{
      setTimeout(()=>{matrixScreen.textContent+="Access Granted\n"; setTimeout(()=>{document.body.innerHTML=''; document.body.style.background='#fff';},1500);},500);
    }
  }
  typeLine();
});
</script>
</body>
</html>
